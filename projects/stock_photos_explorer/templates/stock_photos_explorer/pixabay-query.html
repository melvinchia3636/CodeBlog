{% load static %}
<!DOCTYPE html>
<html>
	<head>
		{% include 'base/head.html' %}
		<link rel="stylesheet" type="text/css" href='{% static "base/navbar.css" %}'>
		<link rel="stylesheet" type="text/css" href='{% static "stock-photos-explorer/main.css" %}'>
		<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	</head>
	<body class='search-result'>
		{% include 'base/navbar.html' %}
		<div class='search-result-header'>
			<div class='search-result-title'>
				<h1></h1>
				<h2></h2>
			</div>
			<form class='searchbox-container'>
				<button class='search-btn'><i data-feather='search' class='search-box-icon'></i></button>
				<input type='text' class='search-box' placeholder='Search images, videos, and vectors' name='q' autocomplete="off">
			</form>
		</div>
		<ul class='image-container'></ul>
		{% include 'base/footer.html' %}
		<script>
			get_params = (key) => {
				address = window.location.search
				parameterList = new URLSearchParams(address)
				return parameterList.get(key)
			}

			$(document).ready(function() {
				feather.replace()
				var query = get_params('q');
				$('input[name="q"]').attr('value', query)
				$('.search-result-title > h1').text('Search results for '+query)
				var api_key = Object.fromEntries(Array.from(document.cookie.split(';'), (i) => i.split('='))).api
				url = 'https://pixabay.com/api/'
				$.ajax({
					url: url,
					method: 'GET',
					data: {
						key: api_key,
						per_page: 100,
						max_height: $(window).height()/2,
						q: query
					},
					success: function(data) {
						$('.search-result-title > h2').text(`${data.total} items found`)
						if (data.total == 0) {
							$('.image-container').append('<h3 class="no-result">Sorry, we couldn\'t find any matches :(<h3><a class="back-to-home" href={% url "pixabay_index" %}>Back to homepage</a>')
							$('.image-container').css({
								'align-items': 'center',
								'height': '70%',
								'flex-direction': 'column'
							})
							return
						}
						for (i of data.hits) {
							$('.image-container').append(`<li><img src="${i.webformatURL}"></li>`)
						}
					}
				})
			})
		</script>
	</body>
</html>